<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IMDb Sentiment Chat</title>
</head>
<body>
    <input type="text" id="userInput" placeholder="Enter text to analyze sentiment" />
    <button onclick="analyzeSentiment()">Analyze</button>
    <div id="chatBox"></div>

    <script>
        // Define the query function for the Hugging Face API call
        async function query(data) {
            const response = await fetch(
                "https://api-inference.huggingface.co/models/Leonuraht/IMDBert",
                {
                    headers: {
                        Authorization: "Bearer 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",
                        "Content-Type": "application/json",
                    },
                    method: "POST",
                    body: JSON.stringify(data),
                }
            );
            const result = await response.json();
            return result;
        }

        async function analyzeSentiment() {
          const userInput = document.getElementById("userInput").value;
          const chatBox = document.getElementById("chatBox");
      
          // Display user message
          chatBox.innerHTML += `<div><strong>You:</strong> ${userInput}</div>`;
      
          try {
              // Send input to the model
              const response = await query({ inputs: userInput });
      
              // Check for response format and parse accordingly
              if (Array.isArray(response) && response[0] && Array.isArray(response[0])) {
                  const scores = response[0]; // Extract the inner list
      
                  // Find LABEL_1 (positive) and LABEL_0 (negative) scores
                  const positiveScoreObj = scores.find(item => item.label === "LABEL_1");
                  const negativeScoreObj = scores.find(item => item.label === "LABEL_0");
      
                  if (positiveScoreObj && negativeScoreObj) {
                      const positiveScore = positiveScoreObj.score;
                      const negativeScore = negativeScoreObj.score;
      
                      // Determine sentiment based on higher score
                      let sentiment;
                      let confidence;
                      if (positiveScore > negativeScore) {
                          sentiment = "Positive";
                          confidence = `${(positiveScore * 100).toFixed(2)}%`;
                      } else {
                          sentiment = "Negative";
                          confidence = `${(negativeScore * 100).toFixed(2)}%`;
                      }
      
                      // Construct bot message
                      const botMessage = `This text has a ${sentiment} sentiment! (Confidence: ${confidence})`;
      
                      chatBox.innerHTML += `<div><strong>Bot:</strong> ${botMessage}</div>`;
                  } else {
                      chatBox.innerHTML += `<div><strong>Bot:</strong> Error: Unexpected response content</div>`;
                  }
              } else {
                  chatBox.innerHTML += `<div><strong>Bot:</strong> Error: Unexpected response format</div>`;
              }
      
              // Clear input field and scroll to bottom
              document.getElementById("userInput").value = "";
              chatBox.scrollTop = chatBox.scrollHeight;
      
          } catch (error) {
              // Handle errors
              chatBox.innerHTML += `<div><strong>Bot:</strong> Error: ${error.message}</div>`;
          }
      }      
      
    </script>
</body>
</html>
